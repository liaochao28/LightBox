!function(t){var i=function(i){var s=this;this.setting={speed:500},t.extend(this.setting,i||{}),this.popupMask=t('<div class="lightbox-mask"></div>'),this.popupWin=t('<div class="lightbox-popup"></div>'),this.bodyNode=t(document.body),this.renderDOM(),this.picViewArea=this.popupWin.find("div.lightbox-pic-view"),this.popupPic=this.popupWin.find("img.lightbox-image"),this.picCaptionArea=this.popupWin.find("div.lightbox-pic-caption"),this.prevBtn=this.popupWin.find("span.lightbox-prev-btn"),this.nextBtn=this.popupWin.find("span.lightbox-next-btn"),this.picCaptionText=this.picCaptionArea.find("h4.lightbox-desc"),this.currentText=this.picCaptionArea.find("p.lightbox-pic-index"),this.closeBtn=this.picCaptionArea.find("span.lightbox-close-btn"),this.groupName=null,this.groupData=[],this.bodyNode.delegate(".js-lightbox,*[data-role=lightbox]","click",function(i){i.stopPropagation();var a=t(this).attr("data-group");a!==s.groupName&&(s.groupName=a,s.getGroup()),s.initPopup(t(this)),s.popupMask.click(function(){t(this).fadeOut(),s.popupWin.fadeOut(),s.clear=!1}),s.closeBtn.click(function(){s.popupMask.fadeOut(),s.popupWin.fadeOut(),s.clear=!1}),this.flag=!0,s.nextBtn.hover(function(){!t(this).hasClass("disabled")&&s.groupData.length>1&&t(this).addClass("lightbox-next-btn-show")},function(){!t(this).hasClass("disabled")&&s.groupData.length>1&&t(this).removeClass("lightbox-next-btn-show")}).click(function(i){!t(this).hasClass("disabled")&&s.groupData.length>1&&s.flag&&(s.flag=!1,i.stopPropagation(),s["goto"]("next"))}),s.prevBtn.hover(function(){!t(this).hasClass("disabled")&&s.groupData.length>1&&t(this).addClass("lightbox-prev-btn-show")},function(){!t(this).hasClass("disabled")&&s.groupData.length>1&&t(this).removeClass("lightbox-prev-btn-show")}).click(function(i){!t(this).hasClass("disabled")&&s.groupData.length>1&&s.flag&&(s.flag=!1,i.stopPropagation(),s["goto"]("prev"))})});var a=null;this.clear=!1,t(window).resize(function(){clearTimeout(a),s.clear&&(a=setTimeout(function(){s.loadPicSize(s.groupData[s.index].src)},500))}).keyup(function(t){var t=t||window.event,i=t.keyCode||t.which;37===i||38===i?s.prevBtn.click():39!==i&&40!==i||s.nextBtn.click()})};i.prototype={"goto":function(t){"next"===t?(this.index++,this.index>=this.groupData.length-1&&this.nextBtn.addClass("disabled").removeClass("lightbox-next-btn-show"),0!==this.index&&this.prevBtn.removeClass("disabled"),this.loadPicSize(this.groupData[this.index].src)):"prev"===t&&(this.index--,this.index<=0&&this.prevBtn.addClass("disabled").removeClass("lightbox-prev-btn-show"),this.index!==this.groupData.length-1&&this.nextBtn.removeClass("disabled"),this.loadPicSize(this.groupData[this.index].src))},changePic:function(i,s){var a=this,e=t(window).width(),n=t(window).height(),o=Math.min(e/(i+10),n/(s+10),1);i*=o,s*=o,a.picViewArea.animate({width:i+10,height:s+10},a.setting.speed),a.popupWin.animate({width:i+10,height:s+10,marginLeft:-(i/2),top:(n-s)/2},a.setting.speed,function(){a.popupPic.css({width:i,height:s}).fadeIn(),a.picCaptionArea.fadeIn(),a.flag=!0,a.clear=!0}),this.picCaptionText.text(this.groupData[this.index].caption),this.currentText.text("当前位置："+(this.index+1)+" of "+this.groupData.length)},loadPicSize:function(t){var i=this;i.popupPic.css({height:"auto",width:"auto"}).hide(),this.picCaptionArea.hide(),this.preLoadImg(t,function(){var s=null,a=null;i.popupPic.attr("src",t),s=i.popupPic.width(),a=i.popupPic.height(),i.changePic(s,a)})},preLoadImg:function(t,i){var s=new Image;window.ActiveXObject?s.onreadystatechange=function(){"complete"===this.readyState&&i&&i()}:s.onload=function(){i&&i()},s.src=t},showMaskAndPopup:function(i,s){var a=this,e=t(window).width(),n=t(window).height(),o=n/2+10,h=this.groupData.length;this.popupPic.hide(),this.picCaptionArea.hide(),this.popupMask.fadeIn(),this.picViewArea.css({width:e/2,height:n/2}),this.popupWin.fadeIn(),this.popupWin.css({width:e/2,height:n/2,marginLeft:-(e/2)/2,top:-o}).animate({top:(n-o)/2},a.setting.speed,function(){a.loadPicSize(i)}),this.index=this.getIndexOf(s),h>1&&(0===this.index?(this.prevBtn.addClass("disabled"),this.nextBtn.removeClass("disabled")):this.index===h-1?(this.prevBtn.removeClass("disabled"),this.nextBtn.addClass("disabled")):(this.prevBtn.removeClass("disabled"),this.nextBtn.removeClass("disabled")))},getIndexOf:function(i){var s=0;return t(this.groupData).each(function(t){return s=t,this.id===i?!1:void 0}),s},initPopup:function(t){var i=t.attr("data-source"),s=t.attr("data-id");this.showMaskAndPopup(i,s)},getGroup:function(){var i=this,s=this.bodyNode.find("*[data-group="+i.groupName+"]");this.groupData=[],t.each(s,function(){i.groupData.push({src:t(this).attr("data-source"),id:t(this).attr("data-id"),caption:t(this).attr("data-caption")})})},renderDOM:function(){var t='<div class="lightbox-pic-view"><span class="lightbox-btn lightbox-prev-btn"></span><img class="lightbox-image" src="" alt=""><span class="lightbox-btn lightbox-next-btn"></span></div><div class="lightbox-pic-caption"><div class="lightbox-caption-area"><h4 class="lightbox-desc"></h4><p class="lightbox-pic-index">图片索引：</p></div><span class="lightbox-close-btn">×</span></div>';this.popupWin.html(t),this.bodyNode.append(this.popupMask).append(this.popupWin)}},window.LightBox=i}(jQuery);